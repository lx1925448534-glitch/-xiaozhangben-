<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>å°è´¦æœ¬</title>

  <!-- PWA: manifest + iOS æ”¯æŒ -->
  <link rel="manifest" href="/static/manifest.webmanifest">
  <meta name="theme-color" content="#f6f8fb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="å°è´¦æœ¬">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <style>
    :root{
      --bg: #f6f8fb;
      --card: rgba(255,255,255,.85);
      --border: rgba(15,23,42,.08);
      --text: #0f172a;
      --muted: rgba(15,23,42,.55);
      --primary: #2563eb;
      --danger: #ef4444;
      --shadow: 0 14px 40px rgba(15,23,42,.08);
      --radius: 16px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial;
      color: var(--text);
      background: radial-gradient(1200px 600px at 20% 0%, rgba(37,99,235,.10), transparent 60%),
                  radial-gradient(1000px 500px at 80% 10%, rgba(16,185,129,.10), transparent 60%),
                  var(--bg);
      min-height: 100vh;
    }

    .wrap{
      max-width: 1100px;
      margin: 28px auto 60px;
      padding: 0 16px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 16px 18px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 220px;
    }

    .logo{
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(37,99,235,.18), rgba(37,99,235,.06));
      border: 1px solid rgba(37,99,235,.18);
      display:grid;
      place-items:center;
    }

    .brand h1{
      font-size: 16px;
      margin: 0;
      line-height: 1.2;
    }
    .brand p{
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: white;
      color: var(--text);
      text-decoration:none;
      font-size: 14px;
      cursor: pointer;
      transition: .15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 24px rgba(15,23,42,.08); }
    .btn.primary{
      background: var(--primary);
      color: white;
      border-color: rgba(37,99,235,.5);
    }
    .btn.danger{
      background: rgba(239,68,68,.08);
      border-color: rgba(239,68,68,.25);
      color: #b91c1c;
    }

    .grid{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap: 18px;
      margin-top: 18px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width: unset; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .card h2{
      margin: 0;
      padding: 16px 18px 6px;
      font-size: 15px;
    }

    .card .body{
      padding: 12px 18px 18px;
    }

    .form-row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    .form-row.one{ grid-template-columns: 1fr; }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input, select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: white;
      outline: none;
      font-size: 14px;
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
    }

    .summary{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      padding: 14px 18px 0;
    }
    @media (max-width: 680px){
      .summary{ grid-template-columns: 1fr; }
    }

    .pill{
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.85);
      padding: 12px 14px;
    }

    .pill .t{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .pill .v{
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .2px;
    }

    .table{
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
    }
    .table-wrap{
      margin-top: 18px;
      padding: 14px 18px 18px;
    }

    th, td{
      font-size: 13px;
      padding: 12px 10px;
      border-bottom: 1px solid rgba(15,23,42,.06);
      text-align: left;
      vertical-align: middle;
    }
    th{ color: var(--muted); font-weight: 600; }
    tr:hover td{ background: rgba(37,99,235,.04); }
    .empty{
      padding: 18px;
      color: var(--muted);
      border: 1px dashed rgba(15,23,42,.18);
      border-radius: 14px;
      background: rgba(255,255,255,.6);
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 12px;
      background: rgba(255,255,255,.8);
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- é¡¶éƒ¨æ  -->
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- ç®€å• SVG å›¾æ ‡ï¼šè´¦æœ¬ -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M7 4h10a2 2 0 0 1 2 2v14H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" stroke="#2563eb" stroke-width="1.8"/>
            <path d="M8 8h8M8 12h8M8 16h6" stroke="#2563eb" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M5 7h2" stroke="#2563eb" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>å°è´¦æœ¬</h1>
          <p>è®°ä¸€ç¬”ï¼Œå¿ƒé‡Œæ›´æ¸…æ¥š</p>
        </div>
      </div>

      <a class="btn" href="/stats" title="æŸ¥çœ‹ç»Ÿè®¡">ç»Ÿè®¡</a>
    </div>

    <div class="grid">

      <!-- è®°è´¦è¡¨å• -->
      <div class="card">
        <h2>å¿«é€Ÿè®°ä¸€ç¬”</h2>
        <div class="body">
          <!-- è¿™é‡Œçš„ action / name ä½ åç«¯å¦‚æœä¸åŒï¼Œå¯ä»¥å†æ”¹ï¼Œä½†å…ˆä¿æŒå¸¸è§å†™æ³• -->
          <form method="post" action="/add" id="addForm">
            <div class="form-row">
              <div>
                <label for="type">ç±»å‹</label>
                <select id="type" name="type" required>
                  <option value="expense">æ”¯å‡º</option>
                  <option value="income">æ”¶å…¥</option>
                </select>
              </div>
              <div>
                <label for="amount">é‡‘é¢</label>
                <input id="amount" name="amount" type="number" step="0.01" min="0" placeholder="ä¾‹å¦‚ï¼š25.5" required />
              </div>
            </div>

            <div class="form-row">
              <div>
                <label for="category">åˆ†ç±»</label>
                <select id="category" name="category" required></select>
              </div>
              <div>
                <label for="date">æ—¥æœŸ</label>
                <input id="date" name="date" type="date" required />
              </div>
            </div>

            <div class="form-row one">
              <div>
                <label for="note">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                <input id="note" name="note" type="text" maxlength="80" placeholder="æ¯”å¦‚ï¼šåˆé¥­ã€åœ°é“ã€å·¥èµ„åˆ°è´¦â€¦" />
              </div>
            </div>

            <button class="btn primary" type="submit" style="width:100%; margin-top: 6px;">ä¿å­˜</button>
            <div class="hint">æç¤ºï¼šä½ åé¢åšâ€œè´¦å·äº’é€šâ€åï¼Œæ‰‹æœºå’Œç”µè„‘ä¼šçœ‹åˆ°åŒä¸€ä»½æ•°æ®ã€‚</div>
          </form>
        </div>
      </div>

      <!-- æ€»è§ˆ + åˆ—è¡¨ -->
      <div class="card">
        <div class="summary">
          <div class="pill">
            <div class="t">æ€»æ”¯å‡º</div>
            <div class="v">Â¥ {{ total_expense if total_expense is not none else "0.00" }}</div>
          </div>
          <div class="pill">
            <div class="t">æ€»æ”¶å…¥</div>
            <div class="v">Â¥ {{ total_income if total_income is not none else "0.00" }}</div>
          </div>
          <div class="pill">
            <div class="t">ç»“ä½™</div>
            <div class="v">Â¥ {{ balance if balance is not none else "0.00" }}</div>
          </div>
        </div>

        <div class="table-wrap">
          {% if records and records|length > 0 %}
            <table class="table">
              <thead>
                <tr>
                  <th style="width:70px;">ID</th>
                  <th style="width:120px;">æ—¥æœŸ</th>
                  <th style="width:90px;">ç±»å‹</th>
                  <th style="width:120px;">åˆ†ç±»</th>
                  <th style="width:110px;">é‡‘é¢</th>
                  <th>å¤‡æ³¨</th>
                  <th style="width:120px;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {% for r in records %}
                  <tr>
                    <td>{{ r.id }}</td>
                    <td>{{ r.date }}</td>
                    <td>
                      {% if r.type == "income" %}
                        <span class="tag">æ”¶å…¥</span>
                      {% else %}
                        <span class="tag">æ”¯å‡º</span>
                      {% endif %}
                    </td>
                    <td>{{ r.category }}</td>
                    <td>Â¥ {{ r.amount }}</td>
                    <td style="color: rgba(15,23,42,.75);">{{ r.note if r.note else "" }}</td>
                    <td>
                      <form method="post" action="/delete/{{ r.id }}" style="margin:0;">
                        <button class="btn danger" type="submit">åˆ é™¤</button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="empty">
              <span aria-hidden="true">ğŸ§¾</span>
              <span>è¿˜æ²¡æœ‰è®°å½•ï¼Œå…ˆè®°ä¸€ç¬”å§ã€‚</span>
            </div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

  <script>
    // é»˜è®¤æ—¥æœŸ = ä»Šå¤©
    (function setToday(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const el = document.getElementById('date');
      if (el && !el.value) el.value = `${yyyy}-${mm}-${dd}`;
    })();

    // åˆ†ç±»ï¼šæ”¯å‡º/æ”¶å…¥ä¸¤å¥—ï¼ˆä½ è¯´æ”¶å…¥å’Œæ”¯å‡ºå®Œå…¨ä¸åŒï¼Œè¿™é‡Œå·²åˆ†å¼€ï¼‰
    const expenseCategories = ["é¤é¥®","äº¤é€š","è´­ç‰©","æˆ¿ç§Ÿ","å¨±ä¹","åŒ»ç–—","å­¦ä¹ ","å…¶ä»–"];
    const incomeCategories  = ["å·¥èµ„","çº¢åŒ…","å…¶ä»–"];

    function fillCategories(){
      const type = document.getElementById('type').value;
      const sel = document.getElementById('category');
      const items = (type === 'income') ? incomeCategories : expenseCategories;
      sel.innerHTML = items.map(x => `<option value="${x}">${x}</option>`).join('');
    }

    document.getElementById('type').addEventListener('change', fillCategories);
    fillCategories();

    // PWAï¼šæ³¨å†Œ Service Workerï¼ˆå¯é€‰ä½†å»ºè®®ï¼Œæœ‰äº†æ‰æ›´åƒâ€œAppâ€ï¼‰
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          await navigator.serviceWorker.register('/static/sw.js');
        } catch (e) {
          // ä¸å½±å“ä½¿ç”¨ï¼Œæ³¨å†Œå¤±è´¥å°±å½“æ™®é€šç½‘é¡µ
        }
      });
    }
  </script>
</body>
</html>


